import json
import os
import sys
from shutil import copy,rmtree
from datetime import datetime
import payloads.inject as ij

json_data = open("vuln.json","r")
data = json.load(json_data)
target = ij.BASE_URL

dirname = "exploits/"

rmtree(os.getcwd()+"/"+dirname, ignore_errors=True)
if not os.path.exists(dirname):
	os.makedirs(dirname)

copy("exploit.py", dirname)

for d in data:
	c = d["class"]
	result = d["results"][list(d["results"])[0]]
	count = 0
	for r in result:
		count = count+1
		paramname= list(r["params"])[0]
		payload = r["params"][paramname] 
		with open(dirname+c.replace(" ","")+str(count)+".sh","w+") as f:
			f.write("#/bin/sh\n")
			f.write("agu="+payload+"\n")
			f.write("python exploit.py " + '"' +target+r["endpoint"] +'" ' + r["method"] + " "+ paramname + ' "$agu"\n')
	


